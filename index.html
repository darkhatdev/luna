<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Luna ğŸ¦‹ Family Language Bridge</title>
<meta name="description" content="Luna â€” Learn Dutch, English, Portuguese & Spanish together as a family">
<meta name="theme-color" content="#0D0B1A">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Noto+Sans:wght@400;500;600;700&family=Caveat:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0D0B1A;--bg1:#151229;--bg2:#1E1A3A;--bg3:#2A2450;
  --purple:#6C4AB6;--purpleL:#9C5EFF;--purpleD:#2D1B69;
  --green:#A8E6CF;--gold:#FFD700;--goldS:#F5DEB3;--silver:#C0C5CE;
  --text:#E8E6F0;--text2:#A8A4C0;--textL:#A8E6CF;
  --ok:#A8E6CF;--err:#FF6B8A;--warn:#FFB86C;--info:#82B1FF;
  --font:'Fredoka',sans-serif;--body:'Noto Sans',sans-serif;--hand:'Caveat',cursive;
  --rad:16px;--radS:10px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;background:var(--bg);color:var(--text);font-family:var(--body);font-size:16px;line-height:1.6;overflow:hidden}
button{font-family:var(--font);cursor:pointer;border:none;outline:none;-webkit-user-select:none;user-select:none}

/* â•â•â• APP SHELL â•â•â• */
.app{width:100%;height:100%;display:flex;flex-direction:column;max-width:480px;margin:0 auto;position:relative;overflow:hidden}
.screen{position:absolute;inset:0;display:flex;flex-direction:column;opacity:0;pointer-events:none;transition:opacity .4s,transform .4s;transform:translateY(20px);overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}
.screen.active{opacity:1;pointer-events:auto;transform:translateY(0)}
.screen::-webkit-scrollbar{width:0}

/* â•â•â• HEADER BAR â•â•â• */
.hbar{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:var(--bg1);border-bottom:1px solid #ffffff08;min-height:56px;flex-shrink:0;z-index:10}
.hbar .back{background:none;color:var(--text2);font-size:22px;padding:4px 8px;border-radius:8px}
.hbar .back:active{background:#ffffff10}
.hbar .title{font-family:var(--font);font-weight:600;font-size:17px;color:var(--text)}
.hbar .xp-pill{display:flex;align-items:center;gap:6px;background:var(--bg2);padding:4px 12px;border-radius:20px;font-family:var(--font);font-size:14px;font-weight:600;color:var(--gold)}
.hbar .xp-pill svg{width:16px;height:16px;fill:var(--gold)}

/* â•â•â• HOME SCREEN â•â•â• */
.home-pad{padding:20px 20px 100px;flex:1}
.moth-hero{text-align:center;padding:20px 0 10px}
.moth-svg{width:140px;height:140px;margin:0 auto;animation:mothFloat 4s ease-in-out infinite}
@keyframes mothFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.moth-speech{position:relative;background:var(--bg2);border:2px solid var(--purple);border-radius:20px 20px 20px 4px;padding:14px 18px;margin:12px 20px 0;font-family:var(--hand);font-size:20px;color:var(--green);text-align:center;line-height:1.4}
.moth-speech::before{content:'';position:absolute;bottom:-10px;left:20px;border:10px solid transparent;border-top-color:var(--purple);border-right-color:var(--purple)}

.moon-progress{text-align:center;margin:20px 0}
.moon-wrap{position:relative;width:80px;height:80px;margin:0 auto}
.moon-ring{width:80px;height:80px;border-radius:50%;border:3px solid var(--bg3);position:relative}
.moon-fill{position:absolute;inset:0;border-radius:50%;border:3px solid var(--gold);border-color:var(--gold) transparent transparent transparent;transform:rotate(-45deg);transition:all .5s}
.moon-text{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:var(--font);font-size:22px;font-weight:700;color:var(--gold)}
.moon-text small{font-size:10px;color:var(--text2);font-weight:500;letter-spacing:1px}
.moon-label{font-family:var(--font);font-size:13px;color:var(--text2);margin-top:6px}

.stats-row{display:flex;justify-content:center;gap:24px;margin:16px 0}
.stat{text-align:center}
.stat .num{font-family:var(--font);font-size:24px;font-weight:700;color:var(--gold)}
.stat .lbl{font-size:11px;color:var(--text2);letter-spacing:1px;text-transform:uppercase}

.section-title{font-family:var(--font);font-size:15px;font-weight:600;color:var(--text2);letter-spacing:2px;text-transform:uppercase;margin:24px 0 12px;padding-left:4px}

/* â•â•â• CATEGORY CARDS â•â•â• */
.cat-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.cat-card{background:var(--bg2);border:1px solid #ffffff08;border-radius:var(--rad);padding:20px 14px;text-align:center;cursor:pointer;transition:all .3s;position:relative;overflow:hidden}
.cat-card:active{transform:scale(.96);background:var(--bg3)}
.cat-card .emoji{font-size:36px;margin-bottom:8px;display:block}
.cat-card .cname{font-family:var(--font);font-size:15px;font-weight:600;color:var(--text)}
.cat-card .ccount{font-size:12px;color:var(--text2);margin-top:2px}
.cat-card .cprog{width:100%;height:3px;background:var(--bg);border-radius:2px;margin-top:10px;overflow:hidden}
.cat-card .cprog-fill{height:100%;background:var(--green);border-radius:2px;transition:width .5s}
.cat-card.done{border-color:var(--green)}
.cat-card.done::after{content:'âœ“';position:absolute;top:8px;right:10px;color:var(--green);font-size:16px;font-weight:bold}

/* â•â•â• LESSON SCREEN â•â•â• */
.lesson-pad{padding:20px;flex:1;display:flex;flex-direction:column}
.lang-tabs{display:flex;gap:6px;margin-bottom:16px;flex-wrap:wrap}
.lang-tab{padding:6px 14px;border-radius:20px;font-family:var(--font);font-size:13px;font-weight:600;background:var(--bg2);color:var(--text2);transition:all .3s}
.lang-tab.active{background:var(--purple);color:white}
.lang-tab:active{transform:scale(.95)}

.card-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px}

/* â•â•â• FLASHCARD â•â•â• */
.flashcard{width:100%;max-width:360px;min-height:280px;background:var(--bg2);border:2px solid var(--bg3);border-radius:var(--rad);padding:30px 24px;text-align:center;cursor:pointer;transition:all .3s;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px}
.flashcard:active{transform:scale(.97);border-color:var(--purple)}
.flashcard .flag{font-size:28px}
.flashcard .word{font-family:var(--font);font-size:clamp(28px,6vw,40px);font-weight:700;color:var(--text);line-height:1.3}
.flashcard .pron{font-family:var(--hand);font-size:20px;color:var(--purpleL);margin-top:2px}
.flashcard .trans{font-size:15px;color:var(--text2);margin-top:6px;min-height:22px}
.flashcard .tap-hint{font-size:12px;color:var(--text2);opacity:.5;margin-top:12px;letter-spacing:1px}
.flashcard .speak-btn{position:absolute;top:14px;right:14px;width:44px;height:44px;border-radius:50%;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:22px;transition:all .2s}
.flashcard .speak-btn:active{background:var(--purple);transform:scale(.9)}

.card-nav{display:flex;gap:12px;margin-top:20px;width:100%;max-width:360px}
.card-nav button{flex:1;padding:14px;border-radius:var(--radS);font-family:var(--font);font-size:15px;font-weight:600;transition:all .2s}
.card-nav button:active{transform:scale(.96)}
.btn-prev{background:var(--bg2);color:var(--text2)}
.btn-next{background:var(--purple);color:white}
.btn-quiz{background:var(--green);color:var(--bg)}

.card-dots{display:flex;gap:6px;margin-top:14px;justify-content:center}
.card-dots .dot{width:8px;height:8px;border-radius:50%;background:var(--bg3);transition:all .3s}
.card-dots .dot.active{background:var(--purple);transform:scale(1.2)}
.card-dots .dot.done{background:var(--green)}

/* â•â•â• FOUR LANGUAGE VIEW â•â•â• */
.four-lang{width:100%;max-width:360px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
.lang-cell{background:var(--bg2);border:1px solid #ffffff08;border-radius:var(--radS);padding:16px 14px;text-align:center;cursor:pointer;transition:all .2s}
.lang-cell:active{transform:scale(.96);border-color:var(--purple)}
.lang-cell .lflag{font-size:22px}
.lang-cell .lword{font-family:var(--font);font-size:18px;font-weight:700;color:var(--text);margin-top:4px;line-height:1.3}
.lang-cell .lpron{font-family:var(--hand);font-size:15px;color:var(--purpleL);margin-top:2px}
.lang-cell .llang{font-size:11px;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-top:4px}

/* â•â•â• QUIZ MODE â•â•â• */
.quiz-area{flex:1;display:flex;flex-direction:column;align-items:center;padding:20px}
.quiz-q{font-family:var(--font);font-size:14px;color:var(--text2);text-align:center;margin-bottom:8px}
.quiz-word{font-family:var(--font);font-size:clamp(28px,7vw,42px);font-weight:700;color:var(--text);text-align:center;margin-bottom:6px}
.quiz-hint{font-family:var(--hand);font-size:18px;color:var(--purpleL);text-align:center;margin-bottom:24px}
.quiz-opts{width:100%;max-width:360px;display:flex;flex-direction:column;gap:10px}
.quiz-opt{width:100%;padding:16px 20px;background:var(--bg2);border:2px solid var(--bg3);border-radius:var(--radS);font-family:var(--font);font-size:16px;font-weight:600;color:var(--text);text-align:left;transition:all .2s}
.quiz-opt:active{transform:scale(.98)}
.quiz-opt.correct{border-color:var(--ok);background:#A8E6CF15;color:var(--ok)}
.quiz-opt.wrong{border-color:var(--err);background:#FF6B8A15;color:var(--err)}
.quiz-opt.disabled{pointer-events:none;opacity:.5}
.quiz-result{text-align:center;margin-top:16px;font-family:var(--font);font-size:15px;min-height:24px}
.quiz-result.yay{color:var(--ok)}
.quiz-result.nay{color:var(--warn)}
.quiz-score{margin-top:20px;text-align:center}
.quiz-score .big{font-family:var(--font);font-size:36px;font-weight:700;color:var(--gold)}
.quiz-score .lbl{font-size:13px;color:var(--text2)}
.quiz-next{margin-top:16px;padding:14px 40px;background:var(--purple);color:white;border-radius:var(--radS);font-family:var(--font);font-size:15px;font-weight:600}

/* â•â•â• CULTURE TIPS â•â•â• */
.culture-card{background:var(--bg2);border-left:4px solid var(--purpleL);border-radius:0 var(--radS) var(--radS) 0;padding:16px 18px;margin:12px 0}
.culture-card .ctitle{font-family:var(--font);font-size:14px;font-weight:600;color:var(--purpleL);margin-bottom:6px}
.culture-card .ctext{font-size:14px;color:var(--text2);line-height:1.6}

/* â•â•â• NAV BAR â•â•â• */
.navbar{display:flex;background:var(--bg1);border-top:1px solid #ffffff08;padding:8px 0;padding-bottom:max(8px,env(safe-area-inset-bottom));flex-shrink:0;position:relative;z-index:20}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px;background:none;color:var(--text2);font-size:11px;font-family:var(--font);transition:all .2s}
.nav-btn.active{color:var(--green)}
.nav-btn svg{width:24px;height:24px;fill:currentColor}
.nav-btn:active{transform:scale(.9)}

/* â•â•â• SETTINGS â•â•â• */
.settings-pad{padding:20px 20px 100px;flex:1}
.setting-group{margin-bottom:24px}
.setting-group h3{font-family:var(--font);font-size:14px;color:var(--text2);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px}
.setting-row{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:var(--bg2);border-radius:var(--radS);margin-bottom:6px}
.setting-row label{font-size:15px;color:var(--text)}
.toggle{width:48px;height:28px;border-radius:14px;background:var(--bg3);position:relative;cursor:pointer;transition:background .3s}
.toggle.on{background:var(--green)}
.toggle::after{content:'';position:absolute;top:3px;left:3px;width:22px;height:22px;border-radius:50%;background:white;transition:transform .3s}
.toggle.on::after{transform:translateX(20px)}

/* â•â•â• STARS BG â•â•â• */
.stars{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.star{position:absolute;width:2px;height:2px;background:white;border-radius:50%;animation:twinkle 3s ease-in-out infinite}
@keyframes twinkle{0%,100%{opacity:.1}50%{opacity:.6}}

/* â•â•â• XP TOAST â•â•â• */
.xp-toast{position:fixed;top:60px;left:50%;transform:translateX(-50%);background:var(--bg2);border:1px solid var(--gold);border-radius:20px;padding:8px 20px;font-family:var(--font);font-size:15px;font-weight:700;color:var(--gold);z-index:100;opacity:0;transition:all .4s;pointer-events:none}
.xp-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â•â•â• RESPONSIVE â•â•â• */
@media(max-width:360px){.cat-grid{gap:8px}.flashcard{padding:20px 16px;min-height:240px}}
@media(min-width:481px){.app{border-left:1px solid #ffffff08;border-right:1px solid #ffffff08}}
</style>
</head>
<body>
<div class="stars" id="stars"></div>
<div class="app" id="app">

<!-- â•â•â• HOME â•â•â• -->
<div class="screen active" id="homeScreen">
  <div class="hbar">
    <div class="title">ğŸ¦‹ Luna</div>
    <div class="xp-pill"><svg viewBox="0 0 24 24"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg><span id="totalXP">0</span> XP</div>
  </div>
  <div class="home-pad">
    <div class="moth-hero">
      <div class="moth-svg" id="mothSVG"></div>
      <div class="moth-speech" id="mothSpeech">Hoi! I'm Luna ğŸ¦‹ Tap a lesson to start learning together!</div>
    </div>
    <div class="moon-progress">
      <div class="moon-wrap">
        <div class="moon-ring"><div class="moon-fill" id="moonFill"></div></div>
        <div class="moon-text"><span id="moonPct">0</span>%<small>COMPLETE</small></div>
      </div>
      <div class="moon-label">Today's Progress</div>
    </div>
    <div class="stats-row">
      <div class="stat"><div class="num" id="statWords">0</div><div class="lbl">Words</div></div>
      <div class="stat"><div class="num" id="statSessions">0</div><div class="lbl">Sessions</div></div>
      <div class="stat"><div class="num" id="statStreak">0</div><div class="lbl">Days</div></div>
    </div>
    <div class="section-title">Lessons</div>
    <div class="cat-grid" id="catGrid"></div>
  </div>
  <div class="navbar">
    <button class="nav-btn active" onclick="showScreen('homeScreen')"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</button>
    <button class="nav-btn" onclick="showScreen('cultureScreen')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>Culture</button>
    <button class="nav-btn" onclick="showScreen('settingsScreen')"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.49.49 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>Settings</button>
  </div>
</div>

<!-- â•â•â• LESSON â•â•â• -->
<div class="screen" id="lessonScreen">
  <div class="hbar">
    <button class="back" onclick="goHome()">â†</button>
    <div class="title" id="lessonTitle">Greetings</div>
    <div class="xp-pill"><svg viewBox="0 0 24 24"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg><span id="lessonXP">0</span></div>
  </div>
  <div class="lesson-pad">
    <div class="lang-tabs" id="langTabs"></div>
    <div class="card-area" id="cardArea"></div>
    <div class="card-dots" id="cardDots"></div>
    <div class="card-nav">
      <button class="btn-prev" onclick="prevCard()">â† Back</button>
      <button class="btn-next" onclick="nextCard()">Next â†’</button>
    </div>
    <button class="btn-quiz" style="width:100%;margin-top:12px;padding:14px;border-radius:var(--radS);font-family:var(--font);font-size:15px;font-weight:600;background:var(--green);color:var(--bg)" onclick="startQuiz()">ğŸ® Start Quiz</button>
  </div>
</div>

<!-- â•â•â• QUIZ â•â•â• -->
<div class="screen" id="quizScreen">
  <div class="hbar">
    <button class="back" onclick="endQuiz()">â†</button>
    <div class="title">Quiz Mode ğŸ®</div>
    <div class="xp-pill"><svg viewBox="0 0 24 24"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg><span id="quizXPDisplay">0</span></div>
  </div>
  <div class="quiz-area" id="quizArea"></div>
</div>

<!-- â•â•â• CULTURE â•â•â• -->
<div class="screen" id="cultureScreen">
  <div class="hbar">
    <button class="back" onclick="showScreen('homeScreen')">â†</button>
    <div class="title">ğŸ‡³ğŸ‡± Dutch Culture</div>
    <div></div>
  </div>
  <div style="padding:20px 20px 100px;flex:1">
    <div class="moth-speech" style="margin:0 0 20px;font-size:18px">Dutch people are super direct â€” it's honesty, not rudeness! Here's what you need to know ğŸ¦‹</div>
    <div id="cultureCards"></div>
  </div>
  <div class="navbar">
    <button class="nav-btn" onclick="showScreen('homeScreen')"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</button>
    <button class="nav-btn active" onclick="showScreen('cultureScreen')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>Culture</button>
    <button class="nav-btn" onclick="showScreen('settingsScreen')"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.49.49 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>Settings</button>
  </div>
</div>

<!-- â•â•â• SETTINGS â•â•â• -->
<div class="screen" id="settingsScreen">
  <div class="hbar">
    <button class="back" onclick="showScreen('homeScreen')">â†</button>
    <div class="title">âš™ï¸ Settings</div>
    <div></div>
  </div>
  <div class="settings-pad">
    <div class="setting-group">
      <h3>Audio</h3>
      <div class="setting-row"><label>Text-to-Speech</label><div class="toggle on" id="ttsToggle" onclick="toggleSetting(this)"></div></div>
      <div class="setting-row"><label>Sound Effects</label><div class="toggle on" id="sfxToggle" onclick="toggleSetting(this)"></div></div>
    </div>
    <div class="setting-group">
      <h3>Learning</h3>
      <div class="setting-row"><label>Show Pronunciation</label><div class="toggle on" id="pronToggle" onclick="toggleSetting(this)"></div></div>
      <div class="setting-row"><label>Show All 4 Languages</label><div class="toggle" id="fourLangToggle" onclick="toggleSetting(this)"></div></div>
    </div>
    <div class="setting-group">
      <h3>Accessibility</h3>
      <div class="setting-row"><label>Reduce Animations</label><div class="toggle" id="reduceMotion" onclick="toggleSetting(this)"></div></div>
      <div class="setting-row"><label>Larger Text</label><div class="toggle" id="largeText" onclick="toggleSetting(this)"></div></div>
    </div>
    <div style="text-align:center;margin-top:30px">
      <div style="font-family:var(--hand);font-size:24px;color:var(--green)">ğŸ¦‹ Luna v1.0</div>
      <div style="font-size:13px;color:var(--text2);margin-top:4px">A DarkHatDev project for Luna</div>
      <div style="font-size:12px;color:var(--text2);margin-top:2px">Built with love by å·¦æ‰‹é¬¼</div>
    </div>
  </div>
  <div class="navbar">
    <button class="nav-btn" onclick="showScreen('homeScreen')"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</button>
    <button class="nav-btn" onclick="showScreen('cultureScreen')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>Culture</button>
    <button class="nav-btn active" onclick="showScreen('settingsScreen')"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.49.49 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>Settings</button>
  </div>
</div>

</div>
<div class="xp-toast" id="xpToast">+10 XP â­</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¦‹ LUNA â€” Family Language Bridge
// A DarkHatDev project Â· å·¦æ‰‹é¬¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â• LESSON DATA â•â•â•
var CATS=[
{id:'greet',name:'Greetings',emoji:'ğŸ‘‹',words:[
  {nl:'Hallo',en:'Hello',pt:'OlÃ¡',es:'Hola',pron:'HAH-loh'},
  {nl:'Hoi',en:'Hi',pt:'Oi',es:'Hola',pron:'hoy'},
  {nl:'Goedemorgen',en:'Good morning',pt:'Bom dia',es:'Buenos dÃ­as',pron:'KHOO-duh-mor-khun'},
  {nl:'Goedemiddag',en:'Good afternoon',pt:'Boa tarde',es:'Buenas tardes',pron:'KHOO-duh-mih-dahkh'},
  {nl:'Goedenavond',en:'Good evening',pt:'Boa noite',es:'Buenas noches',pron:'KHOO-duh-nah-font'},
  {nl:'Tot ziens',en:'Goodbye',pt:'Tchau',es:'AdiÃ³s',pron:'toht zeens'},
  {nl:'Hoe gaat het?',en:'How are you?',pt:'Como vai?',es:'Â¿CÃ³mo estÃ¡s?',pron:'hoo KHAHT ut'},
  {nl:'Goed, dank je',en:'Good, thanks',pt:'Bem, obrigado/a',es:'Bien, gracias',pron:'khoot, dahnk yuh'},
  {nl:'Aangenaam',en:'Nice to meet you',pt:'Prazer',es:'Mucho gusto',pron:'ahn-khuh-NAHM'},
  {nl:'Ik heet...',en:'My name is...',pt:'Meu nome Ã©...',es:'Me llamo...',pron:'ik HAYT'},
]},
{id:'family',name:'Family',emoji:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§',words:[
  {nl:'Oma',en:'Grandma',pt:'VovÃ³',es:'Abuelita',pron:'OH-mah'},
  {nl:'Opa',en:'Grandpa',pt:'VovÃ´',es:'Abuelito',pron:'OH-pah'},
  {nl:'Moeder / Mama',en:'Mother / Mom',pt:'MÃ£e / MamÃ£e',es:'Madre / MamÃ¡',pron:'MOO-dur / MAH-mah'},
  {nl:'Vader / Papa',en:'Father / Dad',pt:'Pai / Papai',es:'Padre / PapÃ¡',pron:'FAH-dur / PAH-pah'},
  {nl:'Zus',en:'Sister',pt:'IrmÃ£',es:'Hermana',pron:'zuhs'},
  {nl:'Broer',en:'Brother',pt:'IrmÃ£o',es:'Hermano',pron:'broor'},
  {nl:'Ik hou van je',en:'I love you',pt:'Eu te amo',es:'Te quiero',pron:'ik HOW fahn yuh'},
  {nl:'Ik mis je',en:'I miss you',pt:'Sinto saudades',es:'Te extraÃ±o',pron:'ik MIS yuh'},
  {nl:'Familie',en:'Family',pt:'FamÃ­lia',es:'Familia',pron:'fah-MEE-lee'},
  {nl:'Lieverd',en:'Sweetheart',pt:'Querido/a',es:'CariÃ±o',pron:'LEE-vurt'},
]},
{id:'food',name:'Food & Dining',emoji:'ğŸ§€',words:[
  {nl:'Brood',en:'Bread',pt:'PÃ£o',es:'Pan',pron:'brohd'},
  {nl:'Kaas',en:'Cheese',pt:'Queijo',es:'Queso',pron:'kahs'},
  {nl:'Water',en:'Water',pt:'Ãgua',es:'Agua',pron:'VAH-tur'},
  {nl:'Koffie',en:'Coffee',pt:'CafÃ©',es:'CafÃ©',pron:'KOF-fee'},
  {nl:'Melk',en:'Milk',pt:'Leite',es:'Leche',pron:'melk'},
  {nl:'Ik heb honger',en:"I'm hungry",pt:'Estou com fome',es:'Tengo hambre',pron:'ik heb HOHNG-ur'},
  {nl:'Lekker!',en:'Delicious!',pt:'Gostoso!',es:'Â¡Delicioso!',pron:'LEK-ur'},
  {nl:'Eet smakelijk!',en:'Enjoy your meal!',pt:'Bom apetite!',es:'Â¡Buen provecho!',pron:'ayt SMAH-kuh-lik'},
  {nl:'De rekening',en:'The bill',pt:'A conta',es:'La cuenta',pron:'duh RAY-kuh-ning'},
  {nl:'Ontbijt',en:'Breakfast',pt:'CafÃ© da manhÃ£',es:'Desayuno',pron:'ont-BAYT'},
]},
{id:'feel',name:'Feelings',emoji:'ğŸ’š',words:[
  {nl:'Blij',en:'Happy',pt:'Feliz',es:'Feliz',pron:'blay'},
  {nl:'Verdrietig',en:'Sad',pt:'Triste',es:'Triste',pron:'fur-DREE-tikh'},
  {nl:'Moe',en:'Tired',pt:'Cansado/a',es:'Cansado/a',pron:'moo'},
  {nl:'Bang',en:'Scared',pt:'Com medo',es:'Asustado/a',pron:'bahng'},
  {nl:'Boos',en:'Angry',pt:'Com raiva',es:'Enojado/a',pron:'bohs'},
  {nl:'Enthousiast',en:'Excited',pt:'Empolgado/a',es:'Emocionado/a',pron:'en-too-zee-AHST'},
  {nl:'Dankbaar',en:'Grateful',pt:'Agradecido/a',es:'Agradecido/a',pron:'DAHNK-bahr'},
  {nl:'Ik voel me...',en:'I feel...',pt:'Eu me sinto...',es:'Me siento...',pron:'ik fool muh'},
  {nl:'Gaat het goed?',en:'Are you okay?',pt:'Tudo bem?',es:'Â¿EstÃ¡s bien?',pron:'khaht ut KHOOT'},
  {nl:'Trots',en:'Proud',pt:'Orgulhoso/a',es:'Orgulloso/a',pron:'trohts'},
]},
{id:'shop',name:'Shopping',emoji:'ğŸ›ï¸',words:[
  {nl:'Hoeveel kost dit?',en:'How much is this?',pt:'Quanto custa?',es:'Â¿CuÃ¡nto cuesta?',pron:'HOO-fayl KOHST dit'},
  {nl:'Te duur',en:'Too expensive',pt:'Muito caro',es:'Muy caro',pron:'tuh DEWR'},
  {nl:'Waar is...?',en:'Where is...?',pt:'Onde fica...?',es:'Â¿DÃ³nde estÃ¡...?',pron:'vahr iss'},
  {nl:'Winkel',en:'Shop',pt:'Loja',es:'Tienda',pron:'VING-kul'},
  {nl:'Supermarkt',en:'Supermarket',pt:'Supermercado',es:'Supermercado',pron:'SOO-pur-markt'},
  {nl:'Pinnen',en:'Pay by card',pt:'Pagar com cartÃ£o',es:'Pagar con tarjeta',pron:'PIN-nun'},
  {nl:'Contant',en:'Cash',pt:'Dinheiro',es:'Efectivo',pron:'kon-TAHNT'},
  {nl:'Bonnetje',en:'Receipt',pt:'Recibo',es:'Recibo',pron:'BON-uh-tyuh'},
  {nl:'Ik wil graag...',en:'I would like...',pt:'Eu gostaria de...',es:'Me gustarÃ­a...',pron:'ik vil KHRAHKH'},
  {nl:'Korting',en:'Discount',pt:'Desconto',es:'Descuento',pron:'KOR-ting'},
]},
{id:'help',name:'Asking for Help',emoji:'ğŸ†˜',words:[
  {nl:'Help!',en:'Help!',pt:'Socorro!',es:'Â¡Ayuda!',pron:'help'},
  {nl:'Kunt u mij helpen?',en:'Can you help me?',pt:'Pode me ajudar?',es:'Â¿Puede ayudarme?',pron:'kuhnt ew may HEL-pun'},
  {nl:'Ik begrijp het niet',en:"I don't understand",pt:'NÃ£o entendo',es:'No entiendo',pron:'ik buh-KHRAYP ut neet'},
  {nl:'Spreekt u Engels?',en:'Do you speak English?',pt:'Fala inglÃªs?',es:'Â¿Habla inglÃ©s?',pron:'spraykt ew ENG-uhls'},
  {nl:'Ik ben verdwaald',en:"I'm lost",pt:'Estou perdido/a',es:'Estoy perdido/a',pron:'ik ben fur-DVAHLT'},
  {nl:'Ik heb een dokter nodig',en:'I need a doctor',pt:'Preciso de um mÃ©dico',es:'Necesito un mÃ©dico',pron:'ik heb un DOK-tur NOH-dikh'},
  {nl:'Langzamer alstublieft',en:'Slower please',pt:'Mais devagar',es:'MÃ¡s despacio',pron:'LAHNG-zah-mur ahlst-ew-BLEEFT'},
  {nl:'Kunt u dat herhalen?',en:'Can you repeat that?',pt:'Pode repetir?',es:'Â¿Puede repetir?',pron:'kuhnt ew daht her-HAH-lun'},
  {nl:'Dank u wel',en:'Thank you',pt:'Obrigado/a',es:'Gracias',pron:'dahnk ew VEHL'},
  {nl:'Sorry',en:'Sorry',pt:'Desculpa',es:'PerdÃ³n',pron:'SAW-ree'},
]},
];

// â•â•â• CULTURE TIPS â•â•â•
var CULTURE=[
  {t:'ğŸ—£ï¸ Dutch Directness',d:"The Dutch say exactly what they mean. If your cooking is bad, they'll tell you. This is honesty (recht voor z'n raap), not rudeness. Respect it â€” and be direct back!"},
  {t:'ğŸ‚ Birthday Rules',d:"On YOUR birthday, YOU bring cake to school/work (you treat others, not the reverse). Everyone says \"Gefeliciteerd!\" to you AND your family. The verjaardagskalender in the bathroom tracks everyone's birthdays."},
  {t:'ğŸš² Cycling is Life',d:"More bikes than people! Get bikes immediately. Stay right on bike paths, use hand signals, have working lights after dark (it's the law), and ALWAYS lock your bike. A bike = fiets (feets)."},
  {t:'ğŸ  Never Drop By Uninvited',d:"Always call or text before visiting. NEVER visit during dinner (~6-7 PM â€” sacred family time). Bring flowers when visiting (never chrysanthemums â€” those are for funerals). Open gifts immediately."},
  {t:'ğŸ•¯ï¸ Gezelligheid',d:"The untranslatable heart of Dutch culture (say: khuh-ZEL-ikh-hite). It means cozy, warm, together, convivial. A candlelit dinner, coffee with friends, a rainy evening at home â€” all gezellig. Learn this word first!"},
  {t:'ğŸ§€ Dutch Food Essentials',d:"Stamppot (mashed potatoes + veg + sausage), hagelslag (chocolate sprinkles on bread â€” yes, for breakfast, yes, adults too), stroopwafel (caramel waffle cookies), bitterballen (deep-fried meat snacks + mustard), and drop (licorice â€” beware dubbel zout!)."},
  {t:'ğŸ’° Going Dutch',d:"Splitting bills equally (samen delen) is standard â€” it reflects fairness, not cheapness. Friends send Tikkie payment requests even for â‚¬2 coffee. Tipping is appreciated but NOT expected (5-10% for great service). Staff earn living wages."},
  {t:'â° Punctuality & Schedule Culture',d:"Lateness is rude. Dutch plan social events weeks ahead â€” spontaneous hangouts are rare. Dinner is at 6 PM sharp. Coffee break at 10:30 with a koekje (cookie). Lunch is ALWAYS cold (sandwiches only)."},
  {t:'ğŸ… Sinterklaas > Christmas',d:"December 5 is bigger than December 25 for Dutch kids. Sinterklaas arrives by steamboat from Spain. Families write funny poems (gedichten) teasing each other and exchange surprise gifts (surprises). Very important tradition!"},
  {t:'âš ï¸ Dutch Language Trap',d:'NEVER say "opgewonden" for "excited" â€” it has a sexual meaning! Use "enthousiast" instead. Also: "half 6" means 5:30 (half TO six), not 6:30. And "morgen" means both "morning" AND "tomorrow."'},
];

// â•â•â• STATE â•â•â•
var state={xp:0,words:0,sessions:0,streak:0,seen:{},quizScores:{}};
var curCat=0,curCard=0,curLang='nl',quizQ=0,quizScore=0,quizWords=[];

// Load saved state
try{var s=localStorage.getItem('luna_state');if(s)state=JSON.parse(s);}catch(e){}
function save(){try{localStorage.setItem('luna_state',JSON.stringify(state));}catch(e){}}

// â•â•â• INIT â•â•â•
function init(){
  makeStars();
  makeMoth();
  renderCats();
  renderCulture();
  updateHome();
}

// â•â•â• STARS â•â•â•
function makeStars(){
  var c=document.getElementById('stars'),h='';
  for(var i=0;i<60;i++){
    var x=Math.random()*100,y=Math.random()*100,d=Math.random()*5,s=1+Math.random()*2;
    h+='<div class="star" style="left:'+x+'%;top:'+y+'%;animation-delay:'+d+'s;width:'+s+'px;height:'+s+'px"></div>';
  }
  c.innerHTML=h;
}

// â•â•â• LUNA MOTH SVG â•â•â•
function makeMoth(){
  document.getElementById('mothSVG').innerHTML=`
  <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="wg" cx="50%" cy="50%"><stop offset="0%" stop-color="#A8E6CF"/><stop offset="100%" stop-color="#6C4AB6" stop-opacity=".3"/></radialGradient>
      <filter id="glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    </defs>
    <!-- wings -->
    <g filter="url(#glow)" opacity=".85">
      <ellipse cx="66" cy="80" rx="48" ry="38" fill="url(#wg)" transform="rotate(-15,66,80)">
        <animateTransform attributeName="transform" type="rotate" values="-15,66,80;-12,66,80;-15,66,80" dur="3s" repeatCount="indefinite"/>
      </ellipse>
      <ellipse cx="134" cy="80" rx="48" ry="38" fill="url(#wg)" transform="rotate(15,134,80)">
        <animateTransform attributeName="transform" type="rotate" values="15,134,80;12,134,80;15,134,80" dur="3s" repeatCount="indefinite"/>
      </ellipse>
      <!-- lower wings -->
      <ellipse cx="60" cy="115" rx="34" ry="28" fill="url(#wg)" opacity=".7" transform="rotate(-25,60,115)">
        <animateTransform attributeName="transform" type="rotate" values="-25,60,115;-20,60,115;-25,60,115" dur="3s" repeatCount="indefinite"/>
      </ellipse>
      <ellipse cx="140" cy="115" rx="34" ry="28" fill="url(#wg)" opacity=".7" transform="rotate(25,140,115)">
        <animateTransform attributeName="transform" type="rotate" values="25,140,115;20,140,115;25,140,115" dur="3s" repeatCount="indefinite"/>
      </ellipse>
    </g>
    <!-- tail streamers -->
    <path d="M85 140 Q70 170 55 190" stroke="#A8E6CF" stroke-width="2" fill="none" opacity=".4">
      <animate attributeName="d" values="M85 140 Q70 170 55 190;M85 140 Q68 168 52 188;M85 140 Q70 170 55 190" dur="4s" repeatCount="indefinite"/>
    </path>
    <path d="M115 140 Q130 170 145 190" stroke="#A8E6CF" stroke-width="2" fill="none" opacity=".4">
      <animate attributeName="d" values="M115 140 Q130 170 145 190;M115 140 Q132 168 148 188;M115 140 Q130 170 145 190" dur="4s" repeatCount="indefinite"/>
    </path>
    <!-- body -->
    <ellipse cx="100" cy="100" rx="12" ry="30" fill="#2D1B69" stroke="#A8E6CF" stroke-width="1.5"/>
    <!-- eyes -->
    <circle cx="93" cy="78" r="7" fill="#0D0B1A"/><circle cx="107" cy="78" r="7" fill="#0D0B1A"/>
    <circle cx="94" cy="77" r="4" fill="#A8E6CF"/><circle cx="108" cy="77" r="4" fill="#A8E6CF"/>
    <circle cx="95" cy="76" r="1.5" fill="white"/>  <circle cx="109" cy="76" r="1.5" fill="white"/>
    <!-- antennae -->
    <path d="M95 70 Q88 50 78 42" stroke="#A8E6CF" stroke-width="1.5" fill="none"/>
    <path d="M105 70 Q112 50 122 42" stroke="#A8E6CF" stroke-width="1.5" fill="none"/>
    <circle cx="78" cy="42" r="3" fill="#A8E6CF" opacity=".6">
      <animate attributeName="opacity" values=".3;.8;.3" dur="2s" repeatCount="indefinite"/>
    </circle>
    <circle cx="122" cy="42" r="3" fill="#A8E6CF" opacity=".6">
      <animate attributeName="opacity" values=".3;.8;.3" dur="2s" repeatCount="indefinite" begin=".5s"/>
    </circle>
    <!-- wing eyespots -->
    <circle cx="55" cy="80" r="8" fill="#6C4AB6" opacity=".5"/><circle cx="55" cy="80" r="4" fill="#9C5EFF" opacity=".4"/>
    <circle cx="145" cy="80" r="8" fill="#6C4AB6" opacity=".5"/><circle cx="145" cy="80" r="4" fill="#9C5EFF" opacity=".4"/>
    <!-- smile -->
    <path d="M95 88 Q100 93 105 88" stroke="#A8E6CF" stroke-width="1.5" fill="none" stroke-linecap="round"/>
  </svg>`;
}

// â•â•â• RENDER HOME â•â•â•
function renderCats(){
  var g=document.getElementById('catGrid'),h='';
  CATS.forEach(function(c,i){
    var seen=state.seen[c.id]||0,pct=Math.round((seen/c.words.length)*100);
    h+='<div class="cat-card'+(pct>=100?' done':'')+'" onclick="openLesson('+i+')">';
    h+='<span class="emoji">'+c.emoji+'</span>';
    h+='<div class="cname">'+c.name+'</div>';
    h+='<div class="ccount">'+c.words.length+' words</div>';
    h+='<div class="cprog"><div class="cprog-fill" style="width:'+pct+'%"></div></div>';
    h+='</div>';
  });
  g.innerHTML=h;
}

function updateHome(){
  document.getElementById('totalXP').textContent=state.xp;
  document.getElementById('statWords').textContent=state.words;
  document.getElementById('statSessions').textContent=state.sessions;
  document.getElementById('statStreak').textContent=state.streak;
  var total=0,done=0;
  CATS.forEach(function(c){total+=c.words.length;done+=(state.seen[c.id]||0);});
  var pct=total?Math.round((done/total)*100):0;
  document.getElementById('moonPct').textContent=pct;
  var deg=-45+(pct/100*360);
  document.getElementById('moonFill').style.transform='rotate('+deg+'deg)';
  renderCats();
}

// â•â•â• SPEECH â•â•â•
function speak(text,lang){
  if(!document.getElementById('ttsToggle').classList.contains('on'))return;
  var map={nl:'nl-NL',en:'en-US',pt:'pt-BR',es:'es-ES'};
  if(!window.speechSynthesis)return;
  window.speechSynthesis.cancel();
  var u=new SpeechSynthesisUtterance(text);
  u.lang=map[lang]||'en-US';
  u.rate=0.75;
  u.pitch=1;
  // Try to find a good voice
  var voices=window.speechSynthesis.getVoices();
  var match=voices.find(function(v){return v.lang.startsWith(map[lang].split('-')[0]);});
  if(match)u.voice=match;
  window.speechSynthesis.speak(u);
}

// â•â•â• SCREENS â•â•â•
function showScreen(id){
  document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active');});
  document.getElementById(id).classList.add('active');
  // Update nav buttons
  document.querySelectorAll('.nav-btn').forEach(function(b){b.classList.remove('active');});
}

function goHome(){showScreen('homeScreen');updateHome();}

// â•â•â• LESSON â•â•â•
function openLesson(idx){
  curCat=idx;curCard=0;curLang='nl';
  var cat=CATS[idx];
  document.getElementById('lessonTitle').textContent=cat.emoji+' '+cat.name;
  document.getElementById('lessonXP').textContent='0';
  renderLangTabs();
  renderCard();
  renderDots();
  showScreen('lessonScreen');
  state.sessions++;
  save();
}

function renderLangTabs(){
  var langs=[{k:'nl',l:'ğŸ‡³ğŸ‡± Dutch'},{k:'en',l:'ğŸ‡ºğŸ‡¸ English'},{k:'pt',l:'ğŸ‡§ğŸ‡· PortuguÃªs'},{k:'es',l:'ğŸ‡ªğŸ‡¸ EspaÃ±ol'},{k:'all',l:'All 4'}];
  var h='';
  langs.forEach(function(l){
    h+='<button class="lang-tab'+(curLang===l.k?' active':'')+'" onclick="switchLang(\''+l.k+'\')">'+l.l+'</button>';
  });
  document.getElementById('langTabs').innerHTML=h;
}

function switchLang(l){curLang=l;renderLangTabs();renderCard();}

function renderCard(){
  var cat=CATS[curCat],w=cat.words[curCard],area=document.getElementById('cardArea');
  if(curLang==='all'){
    area.innerHTML=
      '<div class="four-lang">'+
      '<div class="lang-cell" onclick="speak(\''+esc(w.nl)+'\',\'nl\')"><div class="lflag">ğŸ‡³ğŸ‡±</div><div class="lword">'+w.nl+'</div><div class="lpron">'+w.pron+'</div><div class="llang">Nederlands</div></div>'+
      '<div class="lang-cell" onclick="speak(\''+esc(w.en)+'\',\'en\')"><div class="lflag">ğŸ‡ºğŸ‡¸</div><div class="lword">'+w.en+'</div><div class="llang">English</div></div>'+
      '<div class="lang-cell" onclick="speak(\''+esc(w.pt)+'\',\'pt\')"><div class="lflag">ğŸ‡§ğŸ‡·</div><div class="lword">'+w.pt+'</div><div class="llang">PortuguÃªs</div></div>'+
      '<div class="lang-cell" onclick="speak(\''+esc(w.es)+'\',\'es\')"><div class="lflag">ğŸ‡ªğŸ‡¸</div><div class="lword">'+w.es+'</div><div class="llang">EspaÃ±ol</div></div>'+
      '</div>';
  }else{
    var flags={nl:'ğŸ‡³ğŸ‡±',en:'ğŸ‡ºğŸ‡¸',pt:'ğŸ‡§ğŸ‡·',es:'ğŸ‡ªğŸ‡¸'};
    var trans='';
    if(curLang==='nl')trans=w.en;
    else if(curLang==='en')trans=w.nl+' (Dutch)';
    else if(curLang==='pt')trans=w.nl+' (Dutch) Â· '+w.en;
    else if(curLang==='es')trans=w.nl+' (Dutch) Â· '+w.en;
    area.innerHTML=
      '<div class="flashcard" onclick="speak(\''+esc(w[curLang])+'\',\''+curLang+'\')">'+
      '<button class="speak-btn" onclick="event.stopPropagation();speak(\''+esc(w[curLang])+'\',\''+curLang+'\')">ğŸ”Š</button>'+
      '<div class="flag">'+flags[curLang]+'</div>'+
      '<div class="word">'+w[curLang]+'</div>'+
      (curLang==='nl'?'<div class="pron">'+w.pron+'</div>':'')+
      '<div class="trans">'+trans+'</div>'+
      '<div class="tap-hint">TAP TO HEAR</div>'+
      '</div>';
  }
  // Track seen words
  if(!state.seen[CATS[curCat].id])state.seen[CATS[curCat].id]=0;
  if(curCard>=state.seen[CATS[curCat].id]){
    state.seen[CATS[curCat].id]=curCard+1;
    state.words=0;
    CATS.forEach(function(c){state.words+=state.seen[c.id]||0;});
    save();
  }
  renderDots();
}

function esc(s){return s.replace(/'/g,"\\'").replace(/"/g,'&quot;');}

function renderDots(){
  var cat=CATS[curCat],h='';
  for(var i=0;i<cat.words.length;i++){
    h+='<div class="dot'+(i===curCard?' active':'')+(i<curCard?' done':'')+'"></div>';
  }
  document.getElementById('cardDots').innerHTML=h;
}

function nextCard(){
  var cat=CATS[curCat];
  if(curCard<cat.words.length-1){curCard++;renderCard();addXP(5);}
}
function prevCard(){
  if(curCard>0){curCard--;renderCard();}
}

function addXP(n){
  state.xp+=n;
  document.getElementById('lessonXP').textContent=parseInt(document.getElementById('lessonXP').textContent)+n;
  save();
  // Toast
  var t=document.getElementById('xpToast');
  t.textContent='+'+n+' XP â­';
  t.classList.add('show');
  setTimeout(function(){t.classList.remove('show');},1200);
}

// â•â•â• QUIZ â•â•â•
function startQuiz(){
  var cat=CATS[curCat];
  quizWords=cat.words.slice().sort(function(){return Math.random()-.5;});
  quizQ=0;quizScore=0;
  document.getElementById('quizXPDisplay').textContent='0';
  showScreen('quizScreen');
  renderQuizQ();
}

function renderQuizQ(){
  var area=document.getElementById('quizArea');
  if(quizQ>=quizWords.length){
    // Quiz complete
    var pct=Math.round((quizScore/quizWords.length)*100);
    var xpEarned=quizScore*10;
    addXP(xpEarned);
    area.innerHTML=
      '<div style="text-align:center;padding-top:40px">'+
      '<div style="font-size:60px;margin-bottom:16px">'+(pct>=80?'ğŸ‰':pct>=50?'ğŸ˜Š':'ğŸ’ª')+'</div>'+
      '<div class="quiz-score"><div class="big">'+quizScore+'/'+quizWords.length+'</div><div class="lbl">CORRECT</div></div>'+
      '<div style="font-family:var(--hand);font-size:22px;color:var(--green);margin-top:16px">+'+xpEarned+' XP earned!</div>'+
      '<button class="quiz-next" onclick="endQuiz()" style="margin-top:24px">Back to Lesson</button>'+
      '</div>';
    return;
  }
  var w=quizWords[quizQ];
  // Generate 4 options (1 correct + 3 wrong)
  var opts=[w.nl];
  var pool=CATS[curCat].words.filter(function(x){return x.nl!==w.nl;});
  pool.sort(function(){return Math.random()-.5;});
  for(var i=0;i<3&&i<pool.length;i++)opts.push(pool[i].nl);
  opts.sort(function(){return Math.random()-.5;});

  var h='<div class="quiz-q">What is the Dutch word for:</div>';
  h+='<div class="quiz-word">'+w.en+'</div>';
  h+='<div class="quiz-hint">('+(quizQ+1)+' of '+quizWords.length+')</div>';
  h+='<div class="quiz-opts">';
  opts.forEach(function(o){
    h+='<button class="quiz-opt" onclick="checkQuiz(this,\''+esc(o)+'\',\''+esc(w.nl)+'\')">'+o+'</button>';
  });
  h+='</div>';
  h+='<div class="quiz-result" id="quizResult"></div>';
  area.innerHTML=h;
}

function checkQuiz(btn,picked,correct){
  var btns=document.querySelectorAll('.quiz-opt');
  btns.forEach(function(b){
    b.classList.add('disabled');
    if(b.textContent===correct)b.classList.add('correct');
  });
  var res=document.getElementById('quizResult');
  if(picked===correct){
    btn.classList.add('correct');
    quizScore++;
    res.className='quiz-result yay';
    res.textContent='Correct! ğŸ‰';
    document.getElementById('quizXPDisplay').textContent=quizScore*10;
    speak(correct,'nl');
  }else{
    btn.classList.add('wrong');
    res.className='quiz-result nay';
    res.textContent='Almost! It\'s: '+correct;
  }
  quizQ++;
  setTimeout(renderQuizQ,1500);
}

function endQuiz(){showScreen('lessonScreen');}

// â•â•â• CULTURE â•â•â•
function renderCulture(){
  var c=document.getElementById('cultureCards'),h='';
  CULTURE.forEach(function(t){
    h+='<div class="culture-card"><div class="ctitle">'+t.t+'</div><div class="ctext">'+t.d+'</div></div>';
  });
  c.innerHTML=h;
}

// â•â•â• SETTINGS â•â•â•
function toggleSetting(el){el.classList.toggle('on');}

// â•â•â• SWIPE SUPPORT â•â•â•
(function(){
  var sx=0,sy=0;
  document.getElementById('lessonScreen').addEventListener('touchstart',function(e){
    sx=e.touches[0].clientX;sy=e.touches[0].clientY;
  },{passive:true});
  document.getElementById('lessonScreen').addEventListener('touchend',function(e){
    var dx=e.changedTouches[0].clientX-sx;
    var dy=e.changedTouches[0].clientY-sy;
    if(Math.abs(dx)>Math.abs(dy)&&Math.abs(dx)>50){
      if(dx<0)nextCard();else prevCard();
    }
  },{passive:true});
})();

// â•â•â• LOAD VOICES â•â•â•
if(window.speechSynthesis){
  window.speechSynthesis.onvoiceschanged=function(){};
  window.speechSynthesis.getVoices();
}

// â•â•â• MOTH SPEECH ROTATION â•â•â•
var mothMsgs=[
  "Hoi! Ready to learn? ğŸ¦‹","Let's bridge languages together!",
  "Oma would be so proud ğŸ’š","Dutch is fun â€” trust me!",
  "Every word brings family closer","Gezellig! Let's go! ğŸ‡³ğŸ‡±",
  "Tap a lesson to begin!","You're doing amazing ğŸŒ™",
  "Saudades means missing someone with love ğŸ’š","Four languages, one family ğŸ¦‹"
];
setInterval(function(){
  var el=document.getElementById('mothSpeech');
  if(el)el.textContent=mothMsgs[Math.floor(Math.random()*mothMsgs.length)];
},8000);

// â•â•â• GO â•â•â•
init();
</script>
</body>
</html>
